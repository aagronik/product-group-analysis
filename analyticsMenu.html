<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <link
      href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&amp;display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="loader"></div>
    <div class="content" id="menuContent-part"></div>
  </body>
  <script>
    var loaders = [];

    const renderLoader = () => {
      document.getElementById("loader").innerHTML = loaders.join("<br />");
    };
    const addLoader = (name) => {
      if (loaders.indexOf(name) === -1) loaders.push(name);

      renderLoader();
    };

    const removeLoader = (name) => {
      loaders = loaders.filter((x) => x.trim() !== name.trim());

      renderLoader();
    };

    const loadContent = (part, loader) => {
      const _loader = loader;
      if (_loader) addLoader(_loader);

      return new Promise((resolve, reject) => {
        google.script.run
          .withSuccessHandler((data) => {
            removeLoader(_loader);

            const to = document.getElementById(`${part}-part`);
            if (to) {
              to.innerHTML = data;
              resolve(true);
              return;
            }

            if (part.indexOf(".css") > -1) {
              const to = document.getElementsByTagName("head");
              if (to.length === 0) return;

              const what = document.createElement("style");
              what.innerHTML = data;
              to[0].appendChild(what);
              resolve(true);
              return;
            }

            if (part.indexOf(".js") > -1) {
              const what = document.createElement("script");
              what.innerHTML = data;
              document.body.appendChild(what);
              resolve(true);
              return;
            }
          })
          .withFailureHandler((err) => {
            removeLoader(_loader);

            reject(false);
          })
          .getContent(part);
      });
    };
    window.addEventListener("load", async () => {
      await Promise.all([
        loadContent("menu.css", "Загружаем стили"),
        loadContent("menuContent", "Загружаем контент"),
      ]);

      await loadContent("menu-client.js", "Загружаем скрипты");
    });
  </script>
</html>
